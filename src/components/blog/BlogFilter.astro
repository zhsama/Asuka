---
import { getAllTags, getAllCategories } from '@/utils/blog';

interface Props {
  currentTags?: string[];
  currentCategory?: string;
  currentYear?: number;
}

const { currentTags = [], currentCategory, currentYear } = Astro.props;

const tags = getAllTags();
const categories = getAllCategories();

// 获取年份列表
const currentYearNum = new Date().getFullYear();
const years = Array.from({ length: 5 }, (_, i) => currentYearNum - i);
---

<div class="filter-container">
  <div class="filter-section">
    <h3 class="filter-title">分类</h3>
    <div class="filter-list">
      <a 
        href="/blog" 
        class={`filter-link ${!currentCategory ? 'active' : ''}`}
      >
        全部
      </a>
      {categories.map(category => (
        <a 
          href={`/blog/category/${encodeURIComponent(category.name)}`}
          class={`filter-link ${currentCategory === category.name ? 'active' : ''}`}
        >
          {category.name} ({category.count})
        </a>
      ))}
    </div>
  </div>

  <div class="filter-section">
    <h3 class="filter-title">标签</h3>
    <div class="filter-tags">
      {tags.slice(0, 20).map(tag => (
        <a 
          href={`/blog/tag/${encodeURIComponent(tag.name)}`}
          class={`filter-tag ${currentTags.includes(tag.name) ? 'active' : ''}`}
          style={`font-size: ${Math.min(1.2, 0.8 + (tag.count / 10))}rem;`}
        >
          #{tag.name}
        </a>
      ))}
    </div>
  </div>

  <div class="filter-section">
    <h3 class="filter-title">年份</h3>
    <div class="filter-list">
      <a 
        href="/blog" 
        class={`filter-link ${!currentYear ? 'active' : ''}`}
      >
        全部
      </a>
      {years.map(year => (
        <a 
          href={`/blog/year/${year}`}
          class={`filter-link ${currentYear === year ? 'active' : ''}`}
        >
          {year}
        </a>
      ))}
    </div>
  </div>

  <div class="filter-section">
    <h3 class="filter-title">快速导航</h3>
    <div class="filter-list">
      <a href="/blog" class="filter-link">
        📝 最新文章
      </a>
      <a href="/blog/featured" class="filter-link">
        ⭐ 精选文章
      </a>
      <a href="/blog/archive" class="filter-link">
        📚 文章归档
      </a>
      <a href="/blog/friends" class="filter-link">
        🔗 友情链接
      </a>
    </div>
  </div>
</div>

<style>
  @reference "tailwindcss";

  .filter-container {
    @apply bg-[var(--component-bg)] border border-[var(--border-light)] rounded-lg p-6 backdrop-blur-sm;
  }

  .filter-section {
    @apply mb-6 last:mb-0;
  }

  .filter-title {
    @apply text-lg font-bold text-[var(--primary)] mb-3 flex items-center;
  }

  .filter-title::before {
    content: "";
    @apply w-1 h-4 bg-[var(--primary)] mr-2 rounded;
  }

  .filter-list {
    @apply flex flex-col gap-2;
  }

  .filter-link {
    @apply px-3 py-2 text-[var(--text-secondary)] hover:text-[var(--primary)] hover:bg-[var(--primary)]/10 rounded transition-all duration-200 text-sm;
    text-decoration: none;
  }

  .filter-link.active {
    @apply text-[var(--primary)] bg-[var(--primary)]/20 font-medium;
  }

  .filter-tags {
    @apply flex flex-wrap gap-2;
  }

  .filter-tag {
    @apply px-2 py-1 text-[var(--secondary)] hover:text-[var(--primary)] hover:bg-[var(--secondary)]/20 rounded transition-all duration-200 text-sm;
    text-decoration: none;
  }

  .filter-tag.active {
    @apply text-[var(--primary)] bg-[var(--primary)]/20;
  }

  /* 响应式设计 */
  @media (max-width: 768px) {
    .filter-container {
      @apply p-4;
    }
    
    .filter-section {
      @apply mb-4;
    }
    
    .filter-title {
      @apply text-base;
    }
  }
</style>