---
import { getAllTags, getAllCategories } from '@/utils/blog';
import '@/styles/components/blog-filter.css';

interface Props {
  currentTags?: string[];
  currentCategory?: string;
  currentYear?: number;
}

const { currentTags = [], currentCategory, currentYear } = Astro.props;

const tags = getAllTags();
const categories = getAllCategories();

// è·å–å¹´ä»½åˆ—è¡¨
const currentYearNum = new Date().getFullYear();
const years = Array.from({ length: 5 }, (_, i) => currentYearNum - i);
---

<div class="filter-container">
  <div class="filter-section">
    <h3 class="filter-title">åˆ†ç±»</h3>
    <div class="filter-list">
      <a 
        href="/blog" 
        class={`filter-link ${!currentCategory ? 'active' : ''}`}
      >
        å…¨éƒ¨
      </a>
      {categories.map(category => (
        <a 
          href={`/blog/category/${encodeURIComponent(category.name)}`}
          class={`filter-link ${currentCategory === category.name ? 'active' : ''}`}
        >
          {category.name} ({category.count})
        </a>
      ))}
    </div>
  </div>

  <div class="filter-section">
    <h3 class="filter-title">æ ‡ç­¾</h3>
    <div class="filter-tags">
      {tags.slice(0, 20).map(tag => (
        <a 
          href={`/blog/tag/${encodeURIComponent(tag.name)}`}
          class={`filter-tag ${currentTags.includes(tag.name) ? 'active' : ''}`}
          style={`font-size: ${Math.min(1.2, 0.8 + (tag.count / 10))}rem;`}
        >
          #{tag.name}
        </a>
      ))}
    </div>
  </div>

  <div class="filter-section">
    <h3 class="filter-title">å¹´ä»½</h3>
    <div class="filter-list">
      <a 
        href="/blog" 
        class={`filter-link ${!currentYear ? 'active' : ''}`}
      >
        å…¨éƒ¨
      </a>
      {years.map(year => (
        <a 
          href={`/blog/year/${year}`}
          class={`filter-link ${currentYear === year ? 'active' : ''}`}
        >
          {year}
        </a>
      ))}
    </div>
  </div>

  <div class="filter-section">
    <h3 class="filter-title">å¿«é€Ÿå¯¼èˆª</h3>
    <div class="filter-list">
      <a href="/blog" class="filter-link">
        ğŸ“ æœ€æ–°æ–‡ç« 
      </a>
      <a href="/blog/featured" class="filter-link">
        â­ ç²¾é€‰æ–‡ç« 
      </a>
      <a href="/blog/archive" class="filter-link">
        ğŸ“š æ–‡ç« å½’æ¡£
      </a>
      <a href="/blog/friends" class="filter-link">
        ğŸ”— å‹æƒ…é“¾æ¥
      </a>
    </div>
  </div>
</div>