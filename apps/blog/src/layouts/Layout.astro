---
import BaseHead from '../components/BaseHead.astro';
import NavBar from '../components/NavBar.astro';
import Banner from '../components/Banner.astro';
import Footer from '../components/Footer.astro';

export interface Props {
  title?: string;
  description?: string;
  image?: string;
  canonicalURL?: string;
  showBanner?: boolean;
}

const { 
  title, 
  description, 
  image, 
  canonicalURL,
  showBanner = true	
} = Astro.props;
---

<!doctype html>
<html lang="zh-CN" class="scroll-smooth">
  <head>
    <BaseHead 
      title={title}
      description={description}
      image={image}
      canonicalURL={canonicalURL}
    />
  </head>
  <body class="min-h-screen bg-white transition-colors dark:bg-gray-900">
    <!-- Navigation -->
    <NavBar />
    
    <!-- Banner -->
    <Banner showBanner={showBanner} />
    
    <!-- Main Content -->
    <main class={showBanner ? "pt-4" : "pt-20"}>
      <slot />
    </main>
    
    <!-- Footer -->
    <Footer />
    
    <!-- Back to Top Button -->
    <button
      id="back-to-top"
      class="back-to-top hidden"
      aria-label="返回顶部"
      title="返回顶部"
    >
      <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <path d="m18 15-6-6-6 6"></path>
      </svg>
    </button>
  </body>
</html>

<script>
  // Back to top functionality
  function initBackToTop() {
    const backToTopBtn = document.getElementById('back-to-top') as HTMLButtonElement;
    if (!backToTopBtn) return;

    function toggleBackToTop() {
      if (window.pageYOffset > 300) {
        backToTopBtn.classList.remove('hidden');
        backToTopBtn.classList.add('visible');
      } else {
        backToTopBtn.classList.remove('visible');
        backToTopBtn.classList.add('hidden');
      }
    }

    function scrollToTop() {
      window.scrollTo({
        top: 0,
        behavior: 'smooth'
      });
    }

    window.addEventListener('scroll', toggleBackToTop);
    backToTopBtn.addEventListener('click', scrollToTop);

    // Initial check
    toggleBackToTop();
  }

  // Initialize on page load
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', initBackToTop);
  } else {
    initBackToTop();
  }

  // Navigation active state
  function updateActiveNavItem() {
    const currentPath = window.location.pathname;
    const navLinks = document.querySelectorAll('nav a[href]');
    
    navLinks.forEach(link => {
      const href = link.getAttribute('href');
      if (href && (currentPath === href || (href !== '/' && currentPath.startsWith(href)))) {
        link.classList.add('active');
      } else {
        link.classList.remove('active');
      }
    });
  }

  // Update active nav on page load
  updateActiveNavItem();
</script>

<style is:global>
	@reference "tailwindcss";
  /* Scrollbar styling */
  ::-webkit-scrollbar {
    width: 8px;
  }

  ::-webkit-scrollbar-track {
    @apply bg-gray-100 dark:bg-gray-800;
  }

  ::-webkit-scrollbar-thumb {
    @apply bg-gray-400 dark:bg-gray-600;
    border-radius: 4px;
  }

  ::-webkit-scrollbar-thumb:hover {
    @apply bg-gray-500 dark:bg-gray-500;
  }

  /* Active navigation state */
  nav a.active {
    @apply text-blue-600 dark:text-blue-400;
  }

  /* Back to top button */
  .back-to-top {
    @apply fixed bottom-8 right-8 z-40 flex h-12 w-12 items-center justify-center rounded-full bg-blue-600 text-white shadow-lg transition-all;
    @apply hover:bg-blue-700 hover:shadow-xl;
    @apply dark:bg-blue-500 dark:hover:bg-blue-600;
  }

  .back-to-top.hidden {
    @apply opacity-0 translate-y-2 pointer-events-none;
  }

  .back-to-top.visible {
    @apply opacity-100 translate-y-0 pointer-events-auto;
  }

  /* Smooth transitions */
  * {
    transition-property: color, background-color, border-color, text-decoration-color, fill, stroke;
    transition-timing-function: cubic-bezier(0.4, 0, 0.2, 1);
    transition-duration: 150ms;
  }

  /* Focus styles */
  button:focus-visible,
  a:focus-visible,
  input:focus-visible {
    @apply outline-2 outline-offset-2 outline-blue-600;
  }

  /* Print styles */
  @media print {
    nav,
    .back-to-top,
    footer {
      display: none !important;
    }
  }
</style> 